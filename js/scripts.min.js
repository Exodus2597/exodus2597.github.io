$(document).ready(function() {
  function e() {
      $(".generated").remove(), $(".clear").remove();
      for (var e = $("textarea").val().split("\n"), t = 0; t < e.length; t++)
          $(".output").append(
              '<div class="generated" id="chatlogOutput">' +
              e[t].slice(11) +
              '</div><div class="clear"></div>'
          );
      $(".generated").each(function() {
          var txtString = $(this).text().toLowerCase();
          if (txtString.match(/\*.*\*/)) {
              $(this).addClass("radioColor");
          } else if (txtString.match(/\*.*/)) {
              $(this).addClass("me");
          } else if (txtString.match(/>.*/)) {
              $(this).addClass("me");
          } else if (txtString.match(/.* says:\s*\[S.*\]/)) {
              $(this).addClass("white");
          } else if (txtString.match(/.* says:\s*\[low.*\]/)) {
              $(this).addClass("grey");
          } else if (txtString.match(/you paid \$.*/)) {
              $(this).addClass("money");
          } else if (txtString.match(/you received.*/)) {
              $(this).addClass("money");
          } else if (txtString.match(/you gave.*/)) {
              $(this).addClass("money");
          } else if (txtString.match(/.* paid you \$.*/)) {
              $(this).addClass("money");
          } else if (txtString.match(/you can die.*/)) {
              $(this).addClass("death");
          } else if (txtString.match(/.* whispers:.*/)) {
              $(this).addClass("whisper");
          } else if (txtString.match(/.* whispers:.*\(car\).*/)) {
              $(this).addClass("carwhisper");
          } else if (txtString.match(/.*\(car\).*/)) {
              $(this).addClass("megafon");
          } else if (txtString.match(/.*\(cellphone\).*/)) {
              $(this).addClass("megafon");
          } else {
              $(this).addClass("white");
          }

          txtString || $(this).remove(),
              $(".generated:first").addClass("first-generated");
          $(".generated:last").addClass("last-generated");
          $(".generated").css(
              "background-color",
              "#" + $("#color-picker").spectrum("get").toHex()
          );
      });
  }
  charName = $("#name").val().toLowerCase();
  var t = $.jStorage.get("lastCharName");
  t || $.jStorage.set("lastCharName", ""),
      $("#name").val($.jStorage.get("lastCharName")),
      $("#name").bind("input propertychange", function() {
          (charName = $("#name").val().toLowerCase()),
          $.jStorage.set("lastCharName", charName),
              e();
      });
  var r = $.jStorage.get("lastFontSize"),
      o = $.jStorage.get("lastLineHeight");
  r || o ?
      ($(".output").css({
              "font-size": $.jStorage.get("lastFontSize") + "px",
              "line-height": $.jStorage.get("lastLineHeight") + "px",
          }),
          $("#font-label").text(
              "size (" + $.jStorage.get("lastFontSize") + "px):"
          )) :
      ($.jStorage.set("lastFontSize", "12"),
          $.jStorage.set("lastLineHeight", "0")),
      $("#decrease-fontsize").click(function() {
          (currentSize = parseInt($(".output").css("font-size"))),
          currentSize--,
          (currentLineHeight = parseInt($(".output").css("line-height"))),
          currentLineHeight--,
          currentLineHeight >= 0 ?
              ($(".output").css({
                      "font-size": currentSize + "px",
                      "line-height": currentLineHeight + "px",
                  }),
                  $("#font-label").text("size (" + currentSize + "px):"),
                  $.jStorage.set("lastFontSize", currentSize),
                  $.jStorage.set("lastFontSize", currentLineHeight)) :
              $(this).addClass("disabled");
      }),
      $("#increase-fontsize").click(function() {
          (currentSize = parseInt($(".output").css("font-size"))),
          currentSize++,
          (currentLineHeight = parseInt($(".output").css("line-height"))),
          currentLineHeight++,
          $(".output").css({
                  "font-size": currentSize + "px",
                  "line-height": currentLineHeight + "px",
              }),
              $("#font-label").text("size (" + currentSize + "px):"),
              $.jStorage.set("lastFontSize", currentSize),
              $.jStorage.set("lastLineHeight", currentLineHeight),
              $("#decrease-fontsize").removeClass("disabled");
      }),
      $("#reset-fontsize").click(function() {
          $(".output").css({
                  "font-size": "12px",
                  "line-height": "0px"
              }),
              $("#font-label").text("size (12px):"),
              $.jStorage.set("lastFontSize", "12"),
              $.jStorage.set("lastLineHeight", "0");
      }),
      $("textarea").bind("input propertychange", function() {
          e();
      }),
      $("#color-picker").spectrum({
          color: "#000",
          showInput: !0,
          preferredFormat: "hex",
          change: function() {
              $.jStorage.set("lastColor", $("#color-picker").spectrum("get").toHex()),
                  $(".generated").css(
                      "background-color",
                      "#" + $("#color-picker").spectrum("get").toHex()
                  );
          },
      }),
      $("#color-picker").spectrum("set", $.jStorage.get("lastColor"));
});
